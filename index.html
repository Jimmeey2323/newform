<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: 'Play', sans-serif;
      background-color: #f4f4f9;
      color: #333;
    }
    .form-container {
      margin: 20px;
      padding: 20px;a
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .table-container {
      margin: 20px;
      width: 90%;
      overflow-x: auto;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    button {
      background-color: #1c90ff;
      color: white;
      cursor: pointer;
      padding: 10px;
      border: none;
      border-radius: 4px;
      margin: 10px 0;
    }
    button:hover {
      background-color: #003870;
    }
    .spinner {
      display: none;
      margin: 20px auto;
      border: 16px solid #f3f3f3;
      border-radius: 50%;
      border-top: 16px solid #3498db;
      width: 120px;
      height: 120px;
      animation: spin 2s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .success-message {
      display: none;
      color: green;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="form-container">
    <img src="logo.png" alt="Logo" style="display: block; margin: 0 auto;">
    <label for="trainerName">Trainer Name:</label>
    <select id="trainerName">
      <option value="">Select a trainer</option>
      <option value="Anisha Shah">Anisha Shah</option>
      <option value="Atulan Purohit">Atulan Purohit</option>
      <option value="Jahnavi Jain">Jahnavi Jain</option>
      <option value="Kajol Kanchan">Kajol Kanchan</option>
      <option value="Karan Bhatia">Karan Bhatia</option>
      <option value="Karanvir Bhatia">Karanvir Bhatia</option>
      <option value="Mrigakshi Jaiswal">Mrigakshi Jaiswal</option>
      <option value="Pranjali Jain">Pranjali Jain</option>
      <option value="Pushyank Nahar">Pushyank Nahar</option>
      <option value="Reshma Sharma">Reshma Sharma</option>
      <option value="Richard D'Costa">Richard D'Costa</option>
      <option value="Rohan Dahima">Rohan Dahima</option>
      <option value="Saniya Jaiswal">Saniya Jaiswal</option>
      <option value="Shruti Kulkarni">Shruti Kulkarni</option>
      <option value="Shruti Suresh">Shruti Suresh</option>
      <option value="Upasna Paranjpe">Upasna Paranjpe</option>
      <option value="Vivaran Dhasmana">Vivaran Dhasmana</option>
      <!-- Add more options as needed -->
    </select>
    <label for="date">Date:</label>
    <input type="date" id="date">
    <label for="center">Center:</label>
    <select id="center">
      <option value="">Select a center</option>
      <option value="Supreme HQ, Bandra">Supreme HQ, Bandra</option>
      <option value="Kwality House, Kemps Corner">Kwality House, Kemps Corner</option>
      <option value="Kenkere House">Kenkere House</option>
    </select>
    <button onclick="submitForm()">Go</button>
  </div>
  <div class="spinner" id="spinner"></div>
  <div class="table-container">
    <table id="dynamicTable">
      <thead>
        <tr>
          <th>Member Name</th>
          <th>Class Name</th>
          <th>WhatsApp Message Sent</th>
          <th>Pre-Class Chat Completed</th>
          <th>Comments</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <button class="add-row-btn" onclick="addRow()">Add Row</button>
    <button class="add-row-btn" onclick="finalSubmit()">Submit</button>
    <div class="success-message" id="successMessage">Submission successful!</div>
  </div>
  <script>
    const apiUrl = 'https://script.google.com/macros/s/AKfycbw8sY59_CQ2mmqZha3z0M0q06x0UuWKgOMOZo-2yfcY/dev'; // Replace with your Google Apps Script web app URL

    function submitForm() {
      const trainerName = document.getElementById('trainerName').value;
      const date = document.getElementById('date').value;
      const center = document.getElementById('center').value;
      document.getElementById('spinner').style.display = 'block';

      fetch(`${apiUrl}?trainerName=${trainerName}&date=${date}&center=${center}`)
        .then(response => response.json())
        .then(data => {
          document.getElementById('spinner').style.display = 'none';
          populateTable(data);
        })
        .catch(error => {
          document.getElementById('spinner').style.display = 'none';
          console.error('Error:', error);
        });
    }

    function populateTable(options) {
      const tableBody = document.getElementById('dynamicTable').getElementsByTagName('tbody')[0];
      tableBody.innerHTML = '';
      if (options.length > 0) {
        options.forEach(option => {
          const row = tableBody.insertRow();
          const cell1 = row.insertCell(0);
          const cell2 = row.insertCell(1);
          const cell3 = row.insertCell(2);
          const cell4 = row.insertCell(3);
          const cell5 = row.insertCell(4);
          cell1.textContent = option.memberName;
          cell2.textContent = option.className;
          cell3.innerHTML = '<select><option value="Yes">Yes</option><option value="No">No</option><option value="-">-</option></select>';
          cell4.innerHTML = '<select><option value="Yes">Yes</option><option value="No">No</option><option value="-">-</option></select>';
          cell5.innerHTML = '<input type="text">';
        });
      } else {
        const row = tableBody.insertRow();
        const cell = row.insertCell(0);
        cell.colSpan = 5;
        cell.textContent = 'No records found';
      }
    }

    function addRow() {
      const tableBody = document.getElementById('dynamicTable').getElementsByTagName('tbody')[0];
      const newRow = tableBody.insertRow();
      for (let i = 0; i < 5; i++) {
        const cell = newRow.insertCell(i);
        if (i === 0 || i === 1) {
          cell.innerHTML = '<input type="text">';
        } else if (i === 2 || i === 3) {
          cell.innerHTML = '<select><option value="Yes">Yes</option><option value="No">No</option><option value="-">-</option></select>';
        } else {
          cell.innerHTML = '<input type="text">';
        }
      }
    }

    function finalSubmit() {
      const table = document.getElementById('dynamicTable').getElementsByTagName('tbody')[0];
      const rows = table.getElementsByTagName('tr');
      const data = [];

      for (let i = 0; i < rows.length; i++) {
        const cells = rows[i].getElementsByTagName('td');
        const row = [];
        for (let j = 0; j < cells.length; j++) {
          const inputElement = cells[j].querySelector('select, input');
          if (inputElement) {
            row.push(inputElement.value);
          }
        }
        if (row.length > 0) {
          data.push(row);
        }
      }

      fetch(apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(data => {
        onSuccess();
      })
      .catch(error => {
        console.error('Error:', error);
      });
    }

    function onSuccess() {
      document.getElementById('successMessage').style.display = 'block';
      setTimeout(() => {
        document.getElementById('successMessage').style.display = 'none';
      }, 3000);
      resetFields();
    }

    function resetFields() {
      document.getElementById('trainerName').value = '';
      document.getElementById('date').value = '';
      document.getElementById('center').value = '';
      const tableBody = document.getElementById('dynamicTable').getElementsByTagName('tbody')[0];
      tableBody.innerHTML = '';
    }
  </script>
</body>
</html>
